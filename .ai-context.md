# AI Context - zttt-rs Quick Reference

## What is this project?

The fastest and most optimized Rust backend for simulating TicTacToe games.

**Primary Use Case**: High-throughput game simulations for research, testing, and analysis.

## Key Performance Metrics

- **Speed**: ~1.6ms per game, ~614 games/second
- **Memory**: Minimal footprint with array-based board representation
- **Algorithm**: Minimax with alpha-beta pruning for perfect play

## Quick Architecture Map

```
Board (3x3 array)
  ↓
Engine trait ← PerfectEngine (minimax + alpha-beta)
  ↓
Game simulation at ~614 games/sec
```

## Core API (Most Used)

```rust
// Create board and engine
let mut board = Board::new();
let engine = PerfectEngine::new();

// Make a move
board.make_move(row, col, Player::X)?;

// Get best move
let best_move = engine.choose_move(&board, Player::O);

// Check game state
match board.game_result() {
    GameResult::Win(player) => {},
    GameResult::Draw => {},
    GameResult::InProgress => {},
}

// Query board
let valid_moves = board.valid_moves();
let cell = board.get(row, col);
```

## File Map

| File | Purpose | Key Types/Functions |
|------|---------|---------------------|
| `src/lib.rs` | Public API | Re-exports, tests |
| `src/board.rs` | Game state | `Board`, `make_move()`, `game_result()` |
| `src/engine.rs` | AI engines | `Engine` trait, `PerfectEngine`, `minimax()` |
| `src/player.rs` | Game pieces | `Player`, `Cell` |
| `src/game.rs` | Game results | `GameResult` |
| `examples/simulation.rs` | Batch simulation | Performance testing |
| `examples/benchmark.rs` | Benchmarking | Detailed performance metrics |

## Design Philosophy

1. **Zero runtime dependencies** - Pure Rust, no external crates
2. **Performance-critical** - Every allocation matters
3. **Simple API** - Easy to use, hard to misuse
4. **Simulation-focused** - Optimized for running thousands of games

## Common Operations & Their Cost

| Operation | Typical Time | Notes |
|-----------|-------------|-------|
| `Board::new()` | ~10ns | Stack allocation |
| `make_move()` | ~50ns | Array update + validation |
| `game_result()` | ~100ns | Check all win conditions |
| `valid_moves()` | ~200ns | Iterate 9 cells |
| `choose_move()` (PerfectEngine) | ~1.5ms | Full minimax search |
| Complete game simulation | ~1.6ms | From empty to result |

## Testing Commands

```bash
cargo test                    # All tests
cargo test --doc             # Documentation tests only
cargo run --example simulation --release  # Run 10k games
cargo run --example benchmark --release   # Performance metrics
```

## When Modifying Code

**Hot Paths** (optimize carefully):
- `engine::minimax()` - Called recursively, avoid allocations
- `board::game_result()` - Called frequently, keep checks fast
- `board::valid_moves()` - Used in move generation

**Cold Paths** (less critical):
- `Board::new()` - One-time setup
- Display implementations - Only for debugging
- Error handling - Should never be in hot path

## Repository Vision

**Goal**: Provide the fastest and most optimized backend/interface for simulating TicTacToe games.

**Not Goals**:
- General-purpose game framework
- UI or visualization (leave to consumers)
- Network play or persistence
- Complex game variations

## Integration Patterns

### Research Simulation
```rust
// Test different strategies
let results: Vec<GameResult> = (0..100_000)
    .map(|_| simulate_game_with_engine(&engine))
    .collect();
```

### Performance Testing
```rust
let start = Instant::now();
for _ in 0..10_000 {
    let board = Board::new();
    // ... play game
}
let duration = start.elapsed();
```

### Custom Engine Development
```rust
struct MyEngine { /* config */ }

impl Engine for MyEngine {
    fn choose_move(&self, board: &Board, player: Player) -> Option<(usize, usize)> {
        // Your strategy here
    }
}
```

## Tips for AI Assistants

- **Performance matters**: This is a simulation backend, speed is critical
- **Keep it simple**: Don't add complexity without clear benefit
- **No dependencies**: Suggest stdlib solutions, not external crates
- **Test everything**: Game logic is easy to break
- **Document with examples**: Show actual usage, not just descriptions
